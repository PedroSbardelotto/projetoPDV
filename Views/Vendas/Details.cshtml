@* @model PDV.Models.Vendas

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>Vendas</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.ValorTotal)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ValorTotal)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Status)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.DataEntrada)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.DataEntrada)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.DataAtualizacao)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.DataAtualizacao)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.TipoPagamento)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.TipoPagamento.Descricao)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Cliente)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Cliente.CPF)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.UsuarioEmpresa)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.UsuarioEmpresa.CNPJ)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Fechamento)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Fechamento.Id)
        </dd>
    </dl>
</div>
<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div> *@




@model PDV.Models.Vendas
@using System.Globalization

@{
    ViewData["Title"] = $"Venda #{Model.Id}";
    var culture = new CultureInfo("pt-BR");

    // Definição visual do Status
    string statusBadge = "bg-secondary";
    string statusTexto = "Desconhecido";
    string statusIcon = "bi-question-circle";

    if (Model.Status == 1) // Finalizado
    {
        statusBadge = "bg-success bg-opacity-10 text-success border border-success";
        statusTexto = "Pagamento Aprovado";
        statusIcon = "bi-check-circle-fill";
    }
    else if (Model.Status == 2) // Pendente
    {
        statusBadge = "bg-warning bg-opacity-10 text-warning border border-warning";
        statusTexto = "Pendente (Fiado)";
        statusIcon = "bi-clock-history";
    }
    else if (Model.Status == 0) // Cancelado (Suposição)
    {
        statusBadge = "bg-danger bg-opacity-10 text-danger border border-danger";
        statusTexto = "Cancelado";
        statusIcon = "bi-x-circle-fill";
    }
}

<style>
    .receipt-container {
        max-width: 500px; /* Largura típica de recibo */
        margin: 0 auto;
    }
    
    .dashed-line {
        border-top: 2px dashed #dee2e6;
        margin: 1.5rem 0;
    }

    .receipt-header {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .info-label {
        color: #6c757d;
    }

    .info-value {
        font-weight: 600;
        color: #212529;
        text-align: right;
    }

    /* Esconde botões na hora de imprimir (Ctrl+P) */
    @@media print {
        .no-print { display: none !important; }
        body { background-color: #fff; }
        .receipt-card { box-shadow: none !important; border: none !important; }
    }
</style>

<div class="container py-4">
    
    <div class="receipt-container mb-3 d-flex justify-content-between align-items-center no-print">
        <a asp-action="Index" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left me-2"></i>Voltar
        </a>
        <div>
            @if(Model.Status != 1) 
            {
                <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-outline-primary btn-sm me-1">
                    <i class="bi bi-pencil"></i>
                </a>
            }
            <button onclick="window.print()" class="btn btn-dark btn-sm">
                <i class="bi bi-printer-fill me-2"></i>Imprimir
            </button>
        </div>
    </div>

    <div class="card shadow receipt-card receipt-container border-0">
        <div class="card-body p-4">
            
            <div class="receipt-header">
                <div class="mb-2">
                    <div class="bg-light rounded-circle d-inline-flex p-3 mb-2">
                        <i class="bi bi-receipt fs-2 text-secondary"></i>
                    </div>
                </div>
                
                <h5 class="fw-bold mb-1">Comprovante de Venda</h5>
                <p class="text-muted small mb-2">
                    @if(Model.UsuarioEmpresa != null) 
                    { 
                        @Model.UsuarioEmpresa.NomeRazao <br> 
                        <span>CNPJ: @Model.UsuarioEmpresa.CNPJ</span>
                    }
                    else 
                    { 
                        <span>PDV System</span> 
                    }
                </p>
                <small class="text-muted">
                    @Model.DataEntrada.ToString("dd 'de' MMMM 'de' yyyy, HH:mm", culture)
                </small>
            </div>

            <div class="text-center mb-4">
                <span class="badge @statusBadge px-3 py-2 rounded-pill mb-3">
                    <i class="bi @statusIcon me-1"></i> @statusTexto
                </span>
                <h1 class="display-4 fw-bold text-dark">@Model.ValorTotal.ToString("C", culture)</h1>
            </div>

            <div class="dashed-line"></div>

            <div class="mb-4">
                <h6 class="text-uppercase text-muted small fw-bold mb-3">Dados do Cliente</h6>
                
                <div class="info-row">
                    <span class="info-label">Cliente</span>
                    <span class="info-value">
                        @(Model.Cliente != null ? Model.Cliente.Nome : "Consumidor Final")
                    </span>
                </div>
                @if(Model.Cliente != null && !string.IsNullOrEmpty(Model.Cliente.CPF))
                {
                    <div class="info-row">
                        <span class="info-label">CPF</span>
                        <span class="info-value">@Model.Cliente.CPF</span>
                    </div>
                }
            </div>

            <div class="mb-4">
                <h6 class="text-uppercase text-muted small fw-bold mb-3">Pagamento</h6>
                
                <div class="info-row">
                    <span class="info-label">Forma de Pagamento</span>
                    <span class="info-value">
                        @if (Model.TipoPagamento != null)
                        {
                            <i class="bi bi-credit-card me-1"></i> @Model.TipoPagamento.Descricao
                        }
                        else
                        {
                            <span class="text-muted fst-italic">Não informado</span>
                        }
                    </span>
                </div>
                 <div class="info-row">
                    <span class="info-label">ID da Transação</span>
                    <span class="info-value">#@Model.Id.ToString("D6")</span>
                </div>
                 @if (Model.FechamentoId != null)
                {
                    <div class="info-row">
                        <span class="info-label">Caixa (Fechamento)</span>
                        <span class="info-value">#@Model.FechamentoId</span>
                    </div>
                }
            </div>

            @* <div class="dashed-line"></div>
            <div class="mb-3">
                 <h6 class="text-uppercase text-muted small fw-bold mb-3">Itens</h6>
                 @foreach(var item in Model.ProdutosVenda) {
                    <div class="d-flex justify-content-between mb-2 small">
                        <span>@item.Quantidade x @item.Produto.Nome</span>
                        <span class="fw-bold">@item.ValorTotalItem.ToString("C", culture)</span>
                    </div>
                 }
            </div> *@
            

            <div class="mt-5 text-center">
                <p class="small text-muted mb-1">Obrigado pela preferência!</p>
                <p class="small text-muted" style="font-size: 0.7rem;">Gerado eletronicamente em @DateTime.Now.ToString("g")</p>
                
                <div class="mt-3 opacity-50">
                   <i class="bi bi-upc-scan fs-1"></i>
                </div>
            </div>

        </div>
    </div>
</div>